#!/usr/bin/ruby

require 'hl7-processor'

class LoggingChannel
  extend HL7Processor::Channels::Logging

  log_file "hl7.txt"

  for_all_messages do |hl7|
    log.info("Received a message:#{hl7}")
  end

end

class AnotherLoggingChannel
  extend HL7Processor::Channels::Logging

  log_file "hl7.txt"

  when_matching -> hl7 { hl7 == "hello!"} do |hl7|
    log.info("Found a match!")
  end

end

host = HL7Processor::Host.new do |config|
  config.port      = 5900
  config.processor = HL7Processor::Processors::Immediate
  config.channels  = [LoggingChannel, AnotherLoggingChannel]
end

host.start
